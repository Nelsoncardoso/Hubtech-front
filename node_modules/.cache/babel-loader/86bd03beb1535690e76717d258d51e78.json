{"ast":null,"code":"import _regeneratorRuntime from \"/Users/nelsoncardoso/Downloads/bootcamp-gobarber-frontend-master/node_modules/@babel/runtime/regenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(signIn),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(signUp);\n\nimport { takeLatest, call, put, all } from 'redux-saga/effects';\nimport { toast } from 'react-toastify';\nimport history from \"../../../services/history\";\nimport api from \"../../../services/api\";\nimport { signInSuccess, signFailure } from './actions';\nexport function signIn(_ref) {\n  var payload, email, password, response, user;\n  return _regeneratorRuntime.wrap(function signIn$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          payload = _ref.payload;\n          _context.prev = 1;\n          email = payload.email, password = payload.password;\n          _context.next = 5;\n          return call(api.post, '/auth/sign_in', {\n            email: email,\n            password: password\n          });\n\n        case 5:\n          response = _context.sent;\n          user = response.data.data;\n          console.warn(response.headers);\n          console.warn(JSON.stringify(response.headers));\n          localStorage.setItem('headers', JSON.stringify(response.headers));\n          _context.next = 12;\n          return put(signInSuccess(response.headers['acess-token'], user));\n\n        case 12:\n          history.push('/dashboard');\n          _context.next = 20;\n          break;\n\n        case 15:\n          _context.prev = 15;\n          _context.t0 = _context[\"catch\"](1);\n          toast.error('Falha na autenticação, verifique seus dados');\n          _context.next = 20;\n          return put(signFailure());\n\n        case 20:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[1, 15]]);\n}\nexport function signUp(_ref2) {\n  var payload, name, email, password;\n  return _regeneratorRuntime.wrap(function signUp$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          payload = _ref2.payload;\n          _context2.prev = 1;\n          name = payload.name, email = payload.email, password = payload.password;\n          _context2.next = 5;\n          return call(api.post, '/auth', {\n            name: name,\n            email: email,\n            password: password,\n            provider: true\n          });\n\n        case 5:\n          history.push('/');\n          _context2.next = 13;\n          break;\n\n        case 8:\n          _context2.prev = 8;\n          _context2.t0 = _context2[\"catch\"](1);\n          toast.error('Falha no cadastro, verifique seus dados');\n          _context2.next = 13;\n          return put(signFailure());\n\n        case 13:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[1, 8]]);\n}\nexport function setToken(_ref3) {\n  var payload = _ref3.payload;\n  if (!payload) return;\n  var token = payload.auth.token;\n\n  if (token) {\n    api.defaults.headers.Authorization = \"Bearer \".concat(token);\n  }\n}\nexport function signOut() {\n  history.push('/');\n}\nexport default all([takeLatest('persist/REHYDRATE', setToken), takeLatest('@auth/SIGN_IN_REQUEST', signIn), takeLatest('@auth/SIGN_UP_REQUEST', signUp), takeLatest('@auth/SIGN_OUT', signOut)]);","map":{"version":3,"sources":["/Users/nelsoncardoso/Downloads/bootcamp-gobarber-frontend-master/src/store/modules/auth/sagas.js"],"names":["signIn","signUp","takeLatest","call","put","all","toast","history","api","signInSuccess","signFailure","payload","email","password","post","response","user","data","console","warn","headers","JSON","stringify","localStorage","setItem","push","error","name","provider","setToken","token","auth","defaults","Authorization","signOut"],"mappings":"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","sourcesContent":["import { takeLatest, call, put, all } from 'redux-saga/effects';\nimport { toast } from 'react-toastify';\n\nimport history from '~/services/history';\nimport api from '~/services/api';\n\nimport { signInSuccess, signFailure } from './actions';\n\nexport function* signIn({ payload }) {\n  try {\n    const { email, password } = payload;\n\n    const response = yield call(api.post, '/auth/sign_in', {\n      email,\n      password,\n    });\n\n    const user = response.data.data;\n    console.warn(response.headers)\n    console.warn(JSON.stringify(response.headers))\n    localStorage.setItem('headers', JSON.stringify(response.headers));\n\n    yield put(signInSuccess(response.headers['acess-token'], user));\n\n    history.push('/dashboard');\n  } catch (err) {\n    toast.error('Falha na autenticação, verifique seus dados');\n    yield put(signFailure());\n  }\n}\n\nexport function* signUp({ payload }) {\n  try {\n    const { name, email, password } = payload;\n\n    yield call(api.post, '/auth', {\n      name,\n      email,\n      password,\n      provider: true,\n    });\n\n    history.push('/');\n  } catch (err) {\n    toast.error('Falha no cadastro, verifique seus dados');\n    yield put(signFailure());\n  }\n}\n\nexport function setToken({ payload }) {\n  if (!payload) return;\n\n  const { token } = payload.auth;\n\n  if (token) {\n    api.defaults.headers.Authorization = `Bearer ${token}`;\n  }\n}\n\nexport function signOut() {\n  history.push('/');\n}\n\nexport default all([\n  takeLatest('persist/REHYDRATE', setToken),\n  takeLatest('@auth/SIGN_IN_REQUEST', signIn),\n  takeLatest('@auth/SIGN_UP_REQUEST', signUp),\n  takeLatest('@auth/SIGN_OUT', signOut),\n]);\n"]},"metadata":{},"sourceType":"module"}